<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>焼肉奉行 | タイマー</title>
    <link rel="stylesheet" href="bootstrap-4.3.1-dist/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="app.css" type="text/css" />
<!--    <script src="app.js"></script>-->
</head>
<header>
    <div class="container">
        <div><a href="home.html"><img src="./images/logo.png" width="527" height="200" alt="LOGO"></a></div>
        <ul class="nav justify-content-end">
            <div class="border-left border-right"><li class="nav-item"><a class="nav-link text-white h4 text1 font-weight-bold" href="home.html">ホーム</a></li></div>
            <div class="border-left border-right"><li class="nav-item"><a class="nav-link text-white h4 text1 font-weight-bold" href="timer.html">タイマー</a></li></div>
            <div class="border-left border-right"><li class="nav-item"><a class="nav-link text-white h4 text1 font-weight-bold" href="stopwatch.html">ストップウォッチ</a></li></div>
            <div class="border-left border-right"><li class="nav-item"><a class="nav-link text-white h4 text1 font-weight-bold" href="column.html">コラム的なもの</a></li></div>
            <div class="border-left border-right"><li class="nav-item"><a class="nav-link text-white h4 text1 font-weight-bold" href="yakinikushop.html">焼肉店</a></li></div>
        </ul>
    </div>
</header>

<!--本体-->
<body>
    <div class="main">
        <div class="container">
            <div class="row">

                <!--左側のコンテナ「ここから」-->
                <div class="col-lg-7">
                    <div class="mt-4 mb-4">
                        <canvas id="cvs1" width="560" height="700"></canvas>
                    </div>
                    <!--左側のコンテナ「ここまで」-->
                </div>

                <!--右側のコンテナ「ここから」-->
                <div class="col-lg-5">
                    <!--フォームの作成-->
                    <div class="mx-auto">
                        <form class="food">

                            <!--肉の種類-->
                            <div class="form-group m-4 choice">
                                <label for="select1">
                                    肉の種類
                                </label>
                                <select id="select1" class="select-meet form-control">
                                    <option value='選択なし'>選択なし</option>
                                    <option value="カルビ(牛)">カルビ(牛)</option>
                                    <option>牛サガリ(牛)</option>
                                    <option>ホルモン(牛)</option>
                                    <option value="若鳥(鶏)">若鳥(鶏)</option>
                                    <option>鶏せせり(鶏)</option>
                                    <option>豚バラ(豚)</option>
                                    <option>豚ハラミ(豚)</option>
                                    <option >ホルモン(豚)</option>
                                </select>
                            </div>

                            <script>
                                var On_Plate = [];  
                                var count = 0;
                                class Yakiniku{
                                    constructor(name, x_point, y_point, timer){
                                        this.name = name;
                                        this.x_point = x_point;
                                        this.y_point = y_point;
                                        this.timer = timer;
                                    }
                                    
                                    // 出力先のx座標とy座標
                                    Get_XPoint(){
                                        return this.x_point;
                                    }
                                    Get_YPoint(){
                                        return this.y_point;
                                    }
                                    
                                    // 選択タグから選んだ名前
                                    Get_Name(){
                                        return this.name;
                                    }
                                    
                                    // timer 10s毎に処理を行う
                                    Advance_timer(){
                                        this.timer = this.timer-1;
                                        return this.timer;                                        
                                    }
                                }
                                
                                // CSVファイルから読み取ったデータを連想配列化する関数
                                var csvData = {};
                                function csvToArray(path) {                                
                                    var data = new XMLHttpRequest();        
                                    data.open("GET", path, false);
                                    data.send(null);
                                    var LF = String.fromCharCode(10);
                                    var lines = data.responseText.split(LF);
                                    for (var i = 0; i < lines.length; ++i) {
                                            var cells = lines[i].split(",")
                                            csvData[decodeURI(cells[0].toString())] = {"rare":cells[1], "medium":cells[2], "welldone":cells[3]};
                                    }
                                    console.log(csvData);
                                }
                                
                                // ページロード時に実行
                                window.onload=function () {
                                    csvToArray("yakiniku.csv");
                                    
                                    var canvas = document.getElementById('cvs1');
                                    var ctx = canvas.getContext('2d');
                                    
                                    var image = new Image();
                                    image.src = "./images/ami.png";
                                    image.addEventListener('load', function() {
                                        ctx.drawImage(image, 0, 0, 560, 700);
                                    }, false);
                                }
                                
                                // 選択タグを押した後「焼く」ボタンを押したとき実行する関数
                                function imageDraw() {
                                    var value = document.getElementById('select1');
                                    if(value.values != "選択なし"){
                                        var xpoint = 0;
                                        var ypoint = 0;
                                        
                                        On_Plate[count] = new Yakiniku(value.value, xpoint, ypoint, csvData[value.value]["medium"]);                     

                                    /* ------------ 画像生成　------------ */
                                        var w = 60;
                                        var h = 60;
                                        var canvas = document.getElementById('cvs1');
                                        var ctx = canvas.getContext('2d');                                        
                                        var image = new Image();
                                        image.src = "./images/ami.png";
                                        image.addEventListener('load', function() {
                                            ctx.drawImage(image, 0, 0, 560, 700);
                                            var img2 = new Image();
                                            img2.src = "./images/wakadori.png";
                                            img2.addEventListener('load', function() {
                                                ctx.drawImage(img2, xpoint, ypoint, w, h);
                                                ctx.font = "20px serif";                                        
                                                ctx.fillText(csvData[value.value]["medium"], xpoint+w/2, ypoint+h/2);
                                            }, false);
                                        }, false);
                                        
                                    /* ------------ 画像生成　------------ */
                                        
                                        count+=1;
                                    }
                                }
                                
                                // 10s 毎に実行する関数
                                var log = function(){
                                    idx = 0
                                    
                                    var w = 60;
                                    var h = 60;
                                    var canvas = document.getElementById('cvs1');
                                    var ctx = canvas.getContext('2d');                                        
                                    var image = new Image();
                                    image.src = "./images/ami.png";
                                    image.addEventListener('load', function() {
                                        ctx.clearRect(0, 0, 560, 700);
                                        ctx.drawImage(image, 0, 0, 560, 700);
                                        
                                            // 普通のfor文に直す,エラー普及のために
                                            On_Plate.forEach(function(Yakiniku_Object){
                                               time = Yakiniku_Object.Advance_timer()
                                               if(time<0){
                                                   count--;
                                                   On_Plate.splice(idx,1);
                                               }else{
                                                   idx++;
                                               }
                                                var img2 = new Image();
                                                img2.src = "./images/wakadori.png";
                                                img2.addEventListener('load', function() {
                                                    ctx.drawImage(img2, Yakiniku_Object.x_point, Yakiniku_Object.y_point, w, h);
                                                    
                                                    ctx.font = "30px serif";
                                                    min = parseInt(Yakiniku_Object.timer/60);
                                                    s =  parseInt(Yakiniku_Object.timer - 60 * min);
                                                    if(s<10){
                                                        var time = min + ':0' + s;    
                                                    }
                                                    else{
                                                        var time = min + ':' + s;
                                                    }
                                                    
                                                    ctx.fillText(time , Yakiniku_Object.x_point+20, Yakiniku_Object.y_point+30);
                                                }, false);
                                            }, false);       

                                        }); 
                                    console.log(On_Plate);
                                }
                                
                                setInterval(log, 1000);
                                
                                
                                
                            </script>

                            <!--肉の厚み-->
                            <div class="form-group m-4 dhoice">
                                <label for="select2">
                                    肉の厚み
                                </label>
                                <select class="form-control" id="select2">
                                    <option>普通</option>
                                    <option>厚い</option>
                                    <option>薄い</option>
                                </select>
                            </div>

                            <!--野菜の種類-->
                            <div class="form-group m-4 choice">
                                <label for="select3">
                                    野菜の種類
                                </label>
                                <select class="form-control" id="select3">
                                    <option>選択なし</option>
                                    <option>キャベツ</option>
                                    <option>トウモロコシ</option>
                                    <option>茄子</option>
                                    <option>玉ねぎ</option>
                                    <option>ピーマン</option>
                                </select>
                            </div>

                            <!--海鮮の種類-->
                            <div class="form-group m-4 choice">
                                <label form="select4">
                                    海鮮の種類
                                </label>
                                <select class="form-control" id="select4">
                                    <option>選択なし</option>
                                    <option>イカ</option>
                                    <option>エビ</option>
                                    <option>ししゃも</option>
                                    <option>カニ</option>
                                </select>
                            </div>

                            <!--その他の食べもの-->
                            <div class="form-group m-4 choice">
                                <label for="select5">
                                    その他
                                </label>
                                <select class="form-control" id="select5">
                                    <option>選択なし</option>
                                    <option>コーンバターホイル焼き</option>
                                    <option>ニンニクホイル焼き</option>
                                </select>
                            </div>

                            <!--ボタン-->
                            <div class="float-right mr-4 mb-4">
                                <input type="button" id="btn1" value="焼く" onclick="imageDraw();">
                            </div>
                        </form>

                        <div>
                            <div class="mb-4 ml-4">
                                <img src="./images/tumami_tyu.png" width=280 height=200 alt="網の温度">
                            </div>
                        </div>
                    </div>
                    <!--右側のコンテナ「ここまで」-->
                </div>

            </div>
        </div>
    </div>
</body>

<!--ここからフッター-->
<footer>
    <div class="clearfix">
        <div class="float-right">&copy;YAKINIKUBUGYO</div>
    </div>
</footer>
</html>